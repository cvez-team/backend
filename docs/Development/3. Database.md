# CVEZ Development Document - Database

## Cache Database

We provide 2 ways to implement cache system. Local cache with json file and redis server.

Config provider to use in `apis/<version>/providers/cache_provider/__init__.py` or update `CACHE_PROVIDER` variable.

Provider Options Name:

- Redis: `redis`
- Local Cache: `local`

#### Redis Server

- Run Redis Server locally:

```sh
docker run --rm -d --name redis -p 6379:6379 -v $pwd/data/redis_storage/:/data redis/redis-stack-server:latest
```

- Update Redis Config in `apis/<version>/configs/redis_config.py`

- Environment variable:

```sh
REDIS_HOST="Url to redis server..."
REDIS_PORT=6379
```

#### Create New Provider

- Create new file with name `YOUR_provider.py` in `apis/<version>/providers/cache_provider`

- Import and inherite from `BaseCacheProvider` class.

```python
from .base_provider import BaseCacheProvider

# Class name must contain `CacheProvider` in the end
class YourCacheProvider(BaseCacheProvider):
    def __init__(self, expiration):
        super().__init__(expiration)

    def get(self, key):
        # Get single value by key
        ...

    def gets(self, keys):
        # Get multiple value by multiple keys
        ...

    def set(self, key, value, ttl, merge):
        # Set single value by key pair
        # ttl: Time to expire cache
        # merge: Whether to merge into old data
        ...

    def sets(self, data, ttl):
        # Set multiple key value in dictionary
        ...

    def delete(self, key):
        # Delete single value
        ...

    def deletes(self, keys):
        # Delete multiple values
        ...

    def clear(self):
        # Clear all cache
```

- Modify import or environment to `your` new provider as lowercase.
